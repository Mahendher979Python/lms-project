{% extends "accounts/student/base.html" %}
{% load static %}

{% block title %}Student Dashboard{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* --- THEMES --- */
    :root {
        --accent-blue: #4361ee;
        --accent-purple: #7209b7;
        --accent-pink: #f72585;
        --bg-soft: #f8f9fa;
        --text-dark: #2b2d42;
    }

    body {
        background-color: #f0f2f5;
        font-family: 'Poppins', sans-serif; /* Recommended font */
    }

    .container-dashboard {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px;
    }

    /* --- 3D WELCOME CARD --- */
    .hero-card {
        background: linear-gradient(120deg, var(--accent-blue), var(--accent-purple));
        border-radius: 24px;
        padding: 40px;
        color: white;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 40px -10px rgba(67, 97, 238, 0.4);
        margin-bottom: 40px;
        transform-style: preserve-3d;
        transition: transform 0.3s ease;
    }
    
    .hero-card:hover { transform: translateY(-5px) rotateX(2deg); }

    .hero-content { position: relative; z-index: 2; }
    .hero-card h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
    .hero-card p { font-size: 1.1rem; opacity: 0.9; font-weight: 300; }

    /* Decorative Shapes */
    .shape {
        position: absolute;
        border-radius: 50%;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(5px);
    }
    .shape-1 { width: 300px; height: 300px; top: -100px; right: -50px; }
    .shape-2 { width: 150px; height: 150px; bottom: -50px; left: 100px; background: rgba(255,255,255,0.05); }

    /* --- STATS GRID --- */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        margin-bottom: 40px;
    }

    .stat-box {
        background: white;
        padding: 25px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
        border-bottom: 4px solid transparent;
    }

    .stat-box:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 30px rgba(0,0,0,0.1);
    }

    .stat-box.blue { border-bottom-color: var(--accent-blue); }
    .stat-box.purple { border-bottom-color: var(--accent-purple); }
    .stat-box.pink { border-bottom-color: var(--accent-pink); }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        display: inline-block;
    }
    .text-blue { color: var(--accent-blue); }
    .text-purple { color: var(--accent-purple); }
    .text-pink { color: var(--accent-pink); }

    .stat-number { font-size: 2rem; font-weight: 800; color: var(--text-dark); display: block; }
    .stat-label { color: #8d99ae; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }

    /* --- VISUALIZATIONS --- */
    .viz-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
    }

    .viz-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    }
    
    .viz-header { display: flex; align-items: center; margin-bottom: 25px; }
    .viz-header i { margin-right: 10px; font-size: 1.2rem; }
    .viz-header h3 { margin: 0; color: var(--text-dark); font-size: 1.25rem; font-weight: 700; }

    /* --- COURSE LIST (Compact) --- */
    .course-list-compact {
        margin-top: 40px;
    }
    .course-item {
        background: white;
        padding: 15px 20px;
        border-radius: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        transition: 0.2s;
        border-left: 5px solid #ddd;
    }
    .course-item:hover { transform: scale(1.01); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .course-item.active { border-left-color: var(--accent-blue); }
</style>

<div class="container-dashboard">

    <div class="hero-card">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="hero-content">
            <h1>Hello, {{ request.user.username|title }}! ðŸš€</h1>
            <p>You've completed <strong>85%</strong> of your weekly goals. Keep pushing!</p>
        </div>
    </div>

    <div class="stats-container">
        <div class="stat-box blue">
            <i class="fas fa-layer-group stat-icon text-blue"></i>
            <span class="stat-number">{{ courses.count }}</span>
            <span class="stat-label">Enrolled Courses</span>
        </div>
        <div class="stat-box purple">
            <i class="fas fa-check-circle stat-icon text-purple"></i>
            <span class="stat-number">{{ posts.count }}</span> <span class="stat-label">Trainer Updates</span>
        </div>
        <div class="stat-box pink">
            <i class="fas fa-fire stat-icon text-pink"></i>
            <span class="stat-number">12</span>
            <span class="stat-label">Day Streak</span>
        </div>
    </div>

    <div class="viz-grid">
        <div class="viz-card">
            <div class="viz-header">
                <i class="fas fa-chart-bar text-blue"></i>
                <h3>Learning Progress</h3>
            </div>
            <canvas id="progressChart"></canvas>
        </div>

        <div class="viz-card">
            <div class="viz-header">
                <i class="fas fa-stopwatch text-pink"></i>
                <h3>Time Spent</h3>
            </div>
            <div style="height: 250px; display:flex; justify-content:center;">
                <canvas id="timeChart"></canvas>
            </div>
        </div>
    </div>

    <div class="course-list-compact">
        <h3 style="color:#2b2d42; margin-bottom:15px;">Your Courses</h3>
        {% for course in courses %}
        <div class="course-item active">
            <div>
                <strong>{{ course.title }}</strong>
                <div style="font-size:0.8rem; color:#888;">{{ course.level|title }}</div>
            </div>
            <a href="#" style="text-decoration:none; color:var(--accent-blue); font-weight:bold; font-size:0.9rem;">Continue &rarr;</a>
        </div>
        {% empty %}
        <p>No active courses.</p>
        {% endfor %}
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        Chart.defaults.font.family = "'Poppins', sans-serif";
        Chart.defaults.color = '#64748b';

        // --- 1. PROGRESS BAR CHART (3D Effect via Shadow/Gradient) ---
        const ctxP = document.getElementById('progressChart').getContext('2d');
        
        // Create Gradient
        const gradBlue = ctxP.createLinearGradient(0, 0, 0, 400);
        gradBlue.addColorStop(0, '#4361ee');
        gradBlue.addColorStop(1, '#a5b4fc');

        new Chart(ctxP, {
            type: 'bar',
            data: {
                labels: ['Python', 'Django', 'JS', 'CSS', 'SQL'], // Dummy data
                datasets: [{
                    label: 'Completion %',
                    data: [80, 45, 60, 90, 30],
                    backgroundColor: gradBlue,
                    borderRadius: 10,
                    borderSkipped: false,
                    barThickness: 30,
                    // Shadow effect plugin would go here, simulating simple shadow via CSS mostly
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, max: 100, grid: { borderDash: [5, 5] } },
                    x: { grid: { display: false } }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeOutQuart'
                }
            }
        });

        // --- 2. TIME SPENT (Polar Area - looks very scientific/3D) ---
        const ctxT = document.getElementById('timeChart').getContext('2d');
        new Chart(ctxT, {
            type: 'polarArea',
            data: {
                labels: ['Video', 'Quiz', 'Reading'],
                datasets: [{
                    data: [15, 8, 12],
                    backgroundColor: [
                        'rgba(67, 97, 238, 0.7)',
                        'rgba(247, 37, 133, 0.7)',
                        'rgba(114, 9, 183, 0.7)'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: { ticks: { display: false }, grid: { color: '#e5e7eb' } } // Clean look
                },
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    });
</script>

{% endblock %}