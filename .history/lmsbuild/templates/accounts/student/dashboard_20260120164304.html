{% extends "accounts/student/base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #4f46e5;
        --surface: #ffffff;
        --bg-body: #f1f5f9;
    }

    /* Layout Animations */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .dashboard-container {
        animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        max-width: 1200px;
        margin: 0 auto;
        padding-bottom: 50px;
    }

    /* Welcome Header */
    .welcome-header {
        margin-bottom: 30px;
    }
    .welcome-header h2 { font-size: 2rem; color: #1e293b; margin: 0; }
    .welcome-header p { color: #64748b; margin-top: 5px; }

    /* 3D Cards Styling */
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        /* Simple 3D Shadow Effect */
        box-shadow: 
            0 10px 15px -3px rgba(0, 0, 0, 0.1), 
            0 4px 6px -2px rgba(0, 0, 0, 0.05),
            inset 0 0 0 1px rgba(255, 255, 255, 0.5); 
        border: 1px solid rgba(255,255,255,0.5);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Grid Layout */
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
        margin-top: 30px;
    }

    h3.chart-title {
        font-size: 1.1rem;
        color: #334155;
        margin-bottom: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Stats Row */
    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-box {
        background: linear-gradient(145deg, #ffffff, #f3f4f6);
        padding: 20px;
        border-radius: 16px;
        box-shadow: 5px 5px 10px #d1d5db, -5px -5px 10px #ffffff; /* Neumorphism 3D feel */
        text-align: center;
    }
    .stat-box h4 { font-size: 2.5rem; color: var(--primary); margin: 0; font-weight: 800; }
    .stat-box span { color: #64748b; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; }

</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">

    <div class="welcome-header">
        <h2>Dashboard Overview</h2>
        <p>Here is your learning progress visualized.</p>
    </div>

    <div class="stats-row">
        <div class="stat-box">
            <h4>{{ courses_count }}</h4>
            <span>Active Courses</span>
        </div>
        <div class="stat-box">
            <h4>12</h4>
            <span>Assignments</span>
        </div>
        <div class="stat-box">
            <h4 style="color: #10b981;">98%</h4>
            <span>Attendance</span>
        </div>
    </div>

    <div class="charts-grid">
        
        <div class="glass-card">
            <h3 class="chart-title">ðŸ“ˆ Learning Performance</h3>
            <div id="performanceChart"></div>
        </div>

        <div class="glass-card">
            <h3 class="chart-title">ðŸ§© Subject Distribution</h3>
            <div id="subjectsChart"></div>
        </div>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- DATA FROM BACKEND ---
        // Django variables ni JS loki tecchukuntunnam
        const performanceData = JSON.parse('{{ performance_data|safe }}');
        const monthsLabels = JSON.parse('{{ months_labels|safe }}');
        const subjects = JSON.parse('{{ subjects|safe }}');
        const subjectMarks = JSON.parse('{{ subject_marks|safe }}');

        // --- CHART 1: 3D Area Chart Config ---
        var options1 = {
            series: [{
                name: 'Score',
                data: performanceData
            }],
            chart: {
                type: 'area',
                height: 350,
                toolbar: { show: false }, // Cleaner look
                dropShadow: {
                    enabled: true,
                    top: 10,
                    left: 0,
                    blur: 10,
                    color: '#4f46e5', // Shadow color matches line
                    opacity: 0.3
                }
            },
            colors: ['#4f46e5'],
            fill: {
                type: 'gradient', // Creates 3D Volume
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.1,
                    stops: [0, 90, 100]
                }
            },
            dataLabels: { enabled: false },
            stroke: {
                curve: 'smooth', // Smooth curves look more modern
                width: 4
            },
            xaxis: {
                categories: monthsLabels,
                axisBorder: { show: false },
                axisTicks: { show: false }
            },
            grid: {
                borderColor: '#f1f5f9',
                strokeDashArray: 4,
            }
        };

        var chart1 = new ApexCharts(document.querySelector("#performanceChart"), options1);
        chart1.render();


        // --- CHART 2: 3D Donut Chart Config ---
        var options2 = {
            series: subjectMarks,
            labels: subjects,
            chart: {
                type: 'donut',
                height: 350,
                dropShadow: {
                    enabled: true, // Shadow for 3D depth
                    top: 0,
                    left: 0,
                    blur: 5,
                    color: '#000',
                    opacity: 0.1
                }
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: '70%', // Thicker ring looks more "3D"
                        labels: {
                            show: true,
                            name: { show: true, fontSize: '22px', fontFamily: 'Helvetica, Arial, sans-serif', fontWeight: 600, color: undefined, offsetY: -10 },
                            value: { show: true, fontSize: '16px', fontFamily: 'Helvetica, Arial, sans-serif', fontWeight: 400, color: undefined, offsetY: 16, formatter: function (val) { return val + "%" } },
                            total: { show: true, showAlways: false, label: 'Average', fontSize: '22px', fontFamily: 'Helvetica, Arial, sans-serif', fontWeight: 600, color: '#373d3f', formatter: function (w) { return w.globals.seriesTotals.reduce((a, b) => a + b, 0) / w.globals.series.length + "%" } }
                        }
                    }
                }
            },
            // Modern Color Palette
            colors: ['#4f46e5', '#10b981', '#f59e0b', '#ef4444'],
            dataLabels: { enabled: false }, // Keep it clean
            legend: {
                position: 'bottom',
                markers: { radius: 12 }, // Round markers
            }
        };

        var chart2 = new ApexCharts(document.querySelector("#subjectsChart"), options2);
        chart2.render();
    });
</script>
{% endblock %}