{% extends "accounts/admin/base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.page{padding:25px;background:#f1f5f9;min-height:100vh;font-family:Segoe UI}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:25px}
.card{
background:#fff;
padding:20px;
border-radius:14px;
box-shadow:0 10px 25px rgba(0,0,0,.08);
transition:.3s;
}
.card:hover{transform:translateY(-5px)}
.stat{font-size:32px;font-weight:700;color:#4361ee}
.title{color:#64748b}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:25px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
thead{background:#4361ee;color:#fff}
.section{background:#fff;padding:20px;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
</style>

<div class="page">

<h2>ğŸ“Š Admin Dashboard</h2>
<p>Welcome <b>{{ request.user.username }}</b></p>

<!-- TOP CARDS -->
<div class="cards">

<div class="card">
<div class="title">Total Students</div>
<div class="stat">{{ total_students }}</div>
</div>

<div class="card">
<div class="title">Total Trainers</div>
<div class="stat">{{ total_trainers }}</div>
</div>

<div class="card">
<div class="title">Total Batches</div>
<div class="stat">{{ total_batches }}</div>
</div>

</div>

<!-- CHARTS -->
<div class="grid">

<div class="section">
<h3>ğŸ“ˆ Batch Wise Students</h3>
<canvas id="batchChart" height="200"></canvas>
</div>

<div class="section">
<h3>ğŸ‘¨â€ğŸ« Trainers</h3>

<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Subject</th>
</tr>
</thead>

<tbody>
{% for t in trainers %}
<tr>
<td>{{ t.user.id }}</td>
<td>{{ t.user.username }}</td>
<td>{{ t.subject }}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>

</div>

<br>

<!-- STUDENTS TABLE -->

<div class="section">
<h3>ğŸ‘¨â€ğŸ“ Students</h3>

<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Trainer</th>
<th>Batch</th>
</tr>
</thead>

<tbody>
{% for s in students %}
<tr>
<td>{{ s.user.id }}</td>
<td>{{ s.user.username }}</td>
<td>{{ s.trainer.user.username }}</td>
<td>{{ s.batch.name }}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>

</div>

<script>
const labels=[{% for b in batch_stats %}"{{ b.batch__name }}",{% endfor %}]
const values=[{% for b in batch_stats %}{{ b.count }},{% endfor %}]

new Chart(document.getElementById("batchChart"),{
type:"doughnut",
data:{
labels:labels,
datasets:[{data:values}]
},
options:{
plugins:{legend:{position:"right"}}
}
})
</script>

{% endblock %}
