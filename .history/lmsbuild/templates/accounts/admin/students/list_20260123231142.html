{% extends "accounts/admin/base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --success: #4cc9f0;
        --danger: #f72585;
        --light: #f8f9fa;
        --dark: #212529;
    }

    .dashboard-container { padding: 30px; font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; min-height: 100vh; }
    .header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .header-section h1 { color: var(--dark); font-size: 24px; font-weight: 700; }
    
    .btn-add {
        background: var(--primary); color: white; padding: 10px 20px;
        border-radius: 8px; text-decoration: none; font-weight: 600;
        box-shadow: 0 4px 6px rgba(67, 97, 238, 0.3); transition: transform 0.2s;
    }
    .btn-add:hover { background: var(--secondary); transform: translateY(-2px); }

    .stats-container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 30px; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

    .table-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    table { width: 100%; border-collapse: collapse; }
    thead { background: var(--primary); color: white; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
    tbody tr:hover { background-color: #f8f9fa; }

    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    .status-active { background: #e0fbf6; color: #0f766e; }
    .status-inactive { background: #fee2e2; color: #991b1b; }

    .action-btn { margin-right: 10px; text-decoration: none; font-weight: 600; font-size: 14px; }
    .edit-link { color: var(--primary); }
    .delete-link { color: var(--danger); }
</style>

<div class="dashboard-container">

    <div class="header-section">
        <h1>üë®‚Äçüéì Student Management</h1>
        <a href="{% url 'admin_add_student' %}" class="btn-add">‚ûï Add New Student</a>
    </div>

    <div class="stats-container">
        <div class="card">
            <h3 style="margin-top:0; color:#555;">Enrollment Status</h3>
            <canvas id="statusChart"></canvas>
        </div>

        <div class="card" style="display:flex; flex-direction:column; justify-content:center;">
            <h2 style="font-size: 3rem; margin:0; color: var(--primary);">
                {{ students.count }}
            </h2>
            <p style="color: #777;">Total Students Enrolled</p>
            <div style="margin-top: 20px;">
                <p><strong>System Status:</strong> <span style="color:var(--success)">‚óè Online</span></p>
            </div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Student</th>
                    <th>Roll No</th>
                    <th>Phone</th>
                    <th>Trainer</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                        <div style="font-weight:bold;">{{ student.user.username }}</div>
                        <div style="font-size:12px; color:#888;">{{ student.email }}</div>
                    </td>
                    <td>{{ student.roll_no }}</td>
                    <td>{{ student.phone }}</td>
                    
                    <td>
                        {% if student.trainer %}
                            {{ student.trainer.user.username }}
                        {% else %} - {% endif %}
                    </td>
                    
                    <td>
                        {% if student.trainer %}
                            {{ student.trainer.subject }}
                        {% else %} - {% endif %}
                    </td>

                    <td>
                        {% if student.user.is_active %}
                            <span class="status-badge status-active">Active</span>
                        {% else %}
                            <span class="status-badge status-inactive">Inactive</span>
                        {% endif %}
                    </td>

                    <td>
                        <a href="{% url 'admin_edit_student' student.id %}" class="action-btn edit-link">‚úè Edit</a>
                        <a href="{% url 'admin_delete_student' student.id %}" class="action-btn delete-link" onclick="return confirm('Are you sure you want to deactivate this student?')">üóë Disable</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" style="text-align:center; padding: 30px;">No students found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Logic to count status from the DOM elements rendered by Django
    const activeCount = document.querySelectorAll('.status-active').length;
    const inactiveCount = document.querySelectorAll('.status-inactive').length;

    const ctx = document.getElementById('statusChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Active', 'Inactive'],
            datasets: [{
                data: [activeCount, inactiveCount],
                backgroundColor: ['#4cc9f0', '#f72585'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
</script>

{% endblock %}