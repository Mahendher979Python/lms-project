{% extends "accounts/admin/base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<style>
    :root {
        --bg-img: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2070&auto=format&fit=crop');
        --glass: rgba(30, 41, 59, 0.75);
        --glass-border: rgba(255, 255, 255, 0.1);
        --neon: #6366f1;
        --neon-glow: 0 0 10px #6366f1, 0 0 20px #6366f1;
    }

    body {
        background: var(--bg-img) no-repeat center center fixed;
        background-size: cover;
        color: #f8fafc;
        font-family: 'Segoe UI', sans-serif;
    }

    /* Dark Overlay for readability */
    body::before {
        content: '';
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(2, 6, 23, 0.85); z-index: -1;
    }

    /* 3D Glass Container */
    .glass-box {
        background: var(--glass);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        margin-bottom: 30px;
        transition: transform 0.3s ease;
    }

    .glass-box:hover {
        transform: translateY(-5px);
    }

    h2 { text-shadow: 0 2px 4px rgba(0,0,0,0.5); letter-spacing: 1px; }

    /* 3D Button */
    .btn-3d {
        background: linear-gradient(135deg, #6366f1, #4f46e5);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        display: inline-block;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        border: 1px solid rgba(255,255,255,0.2);
    }

    .btn-3d:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: var(--neon-glow);
        color: white;
    }

    /* Table Styling */
    table { width: 100%; border-collapse: separate; border-spacing: 0 10px; margin-top: 10px; }
    
    th { color: #94a3b8; text-transform: uppercase; font-size: 0.85rem; text-align: left; padding: 10px 15px; }
    
    td {
        background: rgba(2, 6, 23, 0.6);
        padding: 15px;
        border-top: 1px solid var(--glass-border);
        border-bottom: 1px solid var(--glass-border);
    }
    
    td:first-child { border-left: 1px solid var(--glass-border); border-radius: 10px 0 0 10px; }
    td:last-child { border-right: 1px solid var(--glass-border); border-radius: 0 10px 10px 0; }

    tr:hover td {
        background: rgba(99, 102, 241, 0.15);
        cursor: pointer;
    }

    .badge {
        padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;
    }
    .vis-public { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid #059669; }
    .vis-private { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid #b91c1c; }

    .action-link { margin-right: 10px; color: #cbd5e1; text-decoration: none; transition: 0.2s; }
    .action-link:hover { color: var(--neon); text-shadow: 0 0 5px var(--neon); }
</style>

<div style="max-width: 1000px; margin: 0 auto; padding: 20px;">
    
    <div class="glass-box">
        <h2 style="margin-top:0;">üìä Notes Analytics (3D)</h2>
        <div id="echart-container" style="width: 100%; height: 350px;"></div>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin:0;">üìò Recent Notes</h2>
        <a href="{% url 'admin_notes_add' %}" class="btn-3d">‚ûï Create New Note</a>
    </div>

    <div class="glass-box" style="padding: 10px 20px;">
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Course</th>
                    <th>Visibility</th>
                    <th>Assigned</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for n in notes %}
                <tr>
                    <td style="font-weight:600; color: #fff;">{{n.title}}</td>
                    <td>{{n.course.title|default:"-- General --"}}</td>
                    <td>
                        <span class="badge {% if n.visibility == 'public' %}vis-public{% else %}vis-private{% endif %}">
                            {{n.visibility|title}}
                        </span>
                    </td>
                    <td>üë• {{n.assigned_to.count}}</td>
                    <td>
                        <a href="{% url 'admin_notes_edit' n.id %}" class="action-link">‚úèÔ∏è Edit</a>
                        <a href="{% url 'admin_notes_delete' n.id %}" class="action-link" style="color:#f87171;">üóëÔ∏è Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
    // Initialize ECharts for 3D Effect
    var chartDom = document.getElementById('echart-container');
    var myChart = echarts.init(chartDom, 'dark');
    var option;

    option = {
        backgroundColor: 'transparent',
        tooltip: {},
        grid: { top: '15%', bottom: '10%' },
        xAxis: {
            data: ['Total', 'Public', 'Private', 'Courses', 'Users'],
            axisLabel: { color: '#cbd5e1', fontSize: 12 },
            axisLine: { lineStyle: { color: '#334155' } }
        },
        yAxis: {
            axisLine: { lineStyle: { color: '#334155' } },
            splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
        },
        series: [{
            name: 'Count',
            type: 'bar',
            data: [
                {{total_notes}}, 
                {{public_notes}}, 
                {{private_notes}}, 
                {{courses_count}}, 
                {{assigned_users}}
            ],
            itemStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    { offset: 0, color: '#818cf8' },
                    { offset: 0.5, color: '#6366f1' },
                    { offset: 1, color: '#4338ca' }
                ]),
                borderRadius: [5, 5, 0, 0],
                shadowBlur: 10,
                shadowColor: '#6366f1'
            },
            showBackground: true,
            backgroundStyle: { color: 'rgba(255, 255, 255, 0.05)' },
            barWidth: '40%'
        }]
    };

    myChart.setOption(option);
    window.addEventListener('resize', myChart.resize);
</script>

{% endblock %}