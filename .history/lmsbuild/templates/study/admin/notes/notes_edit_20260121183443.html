{% extends "accounts/admin/base.html" %}
{% block content %}

<style>
    :root { --bg-img: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2070'); --accent: #6366f1; }
    body { background: var(--bg-img) no-repeat center center fixed; background-size: cover; color: #f8fafc; }
    body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(2, 6, 23, 0.9); z-index: -1; }

    .form-box {
        max-width: 850px; margin: 40px auto; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(15px);
        border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 40px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); position: relative; overflow: hidden;
    }
    .form-box::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #f59e0b, #ec4899); box-shadow: 0 0 15px #f59e0b; }

    label { display: block; margin-bottom: 8px; color: #94a3b8; font-size: 0.9rem; font-weight: 600; }
    input[type="text"], select, textarea, input[type="file"] {
        width: 100%; background: rgba(2, 6, 23, 0.6); border: 1px solid #334155; color: white; padding: 12px;
        border-radius: 8px; margin-bottom: 20px; transition: 0.3s; box-sizing: border-box;
    }
    input:focus, select:focus, textarea:focus { border-color: #f59e0b; outline: none; box-shadow: 0 0 10px rgba(245, 158, 11, 0.4); background: rgba(2, 6, 23, 0.9); }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .assign-section { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid #334155; }
    .users-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-height: 200px; overflow-y: auto; }
    .chk-label { cursor: pointer; display: inline-flex; align-items: center; gap: 8px; color: #cbd5e1; font-size: 0.9rem; }

    .btn-glow {
        width: 100%; padding: 15px; background: linear-gradient(90deg, #f59e0b, #d97706); border: none;
        color: white; font-size: 1.1rem; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.3s;
        text-transform: uppercase; letter-spacing: 1px;
    }
    .btn-glow:hover { box-shadow: 0 0 25px rgba(245, 158, 11, 0.6); transform: scale(1.01); }
</style>

<div class="form-box">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h2 style="margin:0;">‚úè Edit Note</h2>
        <a href="{% url 'admin_notes_list' %}" style="color:#94a3b8; text-decoration:none;">‚úï Cancel</a>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <label>Title</label>
        <input type="text" name="title" value="{{note.title}}" required>

        <div class="grid-2">
            <div>
                <label>Course</label>
                <select name="course">
                    <option value="">-- Optional --</option>
                    {% for c in courses %}
                    <option value="{{c.id}}" {% if note.course_id == c.id %}selected{% endif %}>{{c.title}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>Visibility</label>
                <select name="visibility">
                    <option value="private" {% if note.visibility == "private" %}selected{% endif %}>üîí Private</option>
                    <option value="public" {% if note.visibility == "public" %}selected{% endif %}>üåç Public</option>
                </select>
            </div>
        </div>

        <label>Description</label>
        <textarea name="description" rows="4">{{note.description}}</textarea>

        <label>Replace File (Current: {% if note.file %}üìÑ Attached{% else %}None{% endif %})</label>
        <input type="file" name="file">

        <label>Assign Users</label>
        <div class="assign-section">
            <div class="users-grid">
                {% for u in all_users %}
                <label class="chk-label">
                    <input type="checkbox" name="assigned_to" value="{{u.id}}"
                    {% if u in note.assigned_to.all %}checked{% endif %}>
                    {{u.username}} <span style="color:#64748b; font-size:0.8em">({{u.role}})</span>
                </label>
                {% endfor %}
            </div>
        </div>

        <br>
        <button class="btn-glow">Save Changes</button>
    </form>
</div>

{% endblock %}