{% extends "accounts/admin/base.html" %}
{% block content %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
.section-title{
margin:40px 0 20px;font-size:22px;font-weight:700;color:#1e293b;
display:flex;align-items:center;gap:10px;border-bottom:2px solid #e2e8f0;padding-bottom:10px
}

.material-grid{
display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px
}

.material-card{
background:white;padding:20px;border-radius:16px;
box-shadow:0 10px 25px rgba(0,0,0,.05);transition:.3s;border:1px solid #f1f5f9
}

.material-card:hover{transform:translateY(-5px);box-shadow:0 15px 35px rgba(0,0,0,.1)}

.card-title{font-weight:600;margin:15px 0;color:#334155}

.btn-group{display:flex;gap:8px}

.btn{
flex:1;padding:10px;border-radius:10px;text-decoration:none;font-size:.85rem;
font-weight:600;text-align:center;border:none;cursor:pointer
}

.btn-preview{background:#eef2ff;color:#4f46e5}
.btn-download{background:#f0fdf4;color:#16a34a}

.btn-preview:hover{background:#4f46e5;color:white}
.btn-download:hover{background:#16a34a;color:white}

/* Modal */
.modal{
display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.8);align-items:center;justify-content:center;z-index:9999
}

.modal-content{
background:white;width:90%;height:90%;border-radius:20px;position:relative
}

.close-modal{
position:absolute;top:10px;right:20px;font-size:30px;cursor:pointer
}

iframe{width:100%;height:100%}
.preview-img{max-width:100%;max-height:100%;margin:auto;display:block}
</style>

<h2><i class="fa-solid fa-box"></i> Material Library</h2>

<div id="previewModal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closePreview()">&times;</span>
<div id="previewBody" style="width:100%;height:100%"></div>
</div>
</div>

<!-- ================= PDF ================= -->
<div class="section-title"><i class="fa-solid fa-file-pdf"></i> PDFs</div>

<div class="material-grid">
{% for m in materials %}
{% if m.file.url|lower|endswith:".pdf" %}
<div class="material-card">
<center><i class="fa-solid fa-file-pdf fa-3x" style="color:red"></i></center>

<p class="card-title">{{m.title}}</p>

<div class="btn-group">
<button class="btn btn-preview" onclick="previewPDF('{{m.file.url}}')">Preview</button>
<a class="btn btn-download" href="{{m.file.url}}" download>Download</a>
</div>
</div>
{% endif %}
{% endfor %}
</div>

<!-- ================= Images ================= -->
<div class="section-title"><i class="fa-solid fa-image"></i> Images</div>

<div class="material-grid">
{% for m in materials %}
{% if m.file.url|lower|endswith:".jpg" or m.file.url|lower|endswith:".jpeg" or m.file.url|lower|endswith:".png" or m.file.url|lower|endswith:".webp" %}
<div class="material-card">
<img src="{{m.file.url}}" width="100%" height="150" style="object-fit:cover">

<p class="card-title">{{m.title}}</p>

<div class="btn-group">
<button class="btn btn-preview" onclick="previewImage('{{m.file.url}}')">Preview</button>
<a class="btn btn-download" href="{{m.file.url}}" download>Download</a>
</div>
</div>
{% endif %}
{% endfor %}
</div>

<!-- ================= Videos ================= -->
<div class="section-title"><i class="fa-solid fa-video"></i> Videos</div>

<div class="material-grid">
{% for m in materials %}
{% if m.file.url|lower|endswith:".mp4" %}
<div class="material-card">
<video src="{{m.file.url}}" width="100%" height="150"></video>

<p class="card-title">{{m.title}}</p>

<div class="btn-group">
<a class="btn btn-preview" href="{{m.file.url}}" target="_blank">Play</a>
<a class="btn btn-download" href="{{m.file.url}}" download>Download</a>
</div>
</div>
{% endif %}
{% endfor %}
</div>

<script>

function previewPDF(url){
document.getElementById("previewBody").innerHTML =
`<iframe src="${url}"></iframe>`;
document.getElementById("previewModal").style.display="flex";
}

function previewImage(url){
document.getElementById("previewBody").innerHTML =
`<img src="${url}" class="preview-img">`;
document.getElementById("previewModal").style.display="flex";
}

function closePreview(){
document.getElementById("previewModal").style.display="none";
document.getElementById("previewBody").innerHTML="";
}

window.onclick=function(e){
if(e.target==document.getElementById("previewModal")) closePreview();
}

</script>

{% endblock %}
