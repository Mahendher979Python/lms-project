{% extends "accounts/admin/base.html" %}
{% block content %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
    --primary:#4f46e5;
    --cyan:#00f3ff;
    --lime:#ccff00;
    --glass:rgba(255,255,255,.07);
    --border:rgba(255,255,255,.15);
}

body{font-family:'Inter', sans-serif; background:#020617; color:#e5e7eb}

.wrap{padding:30px}

.header{
    display:flex; justify-content:space-between; align-items:center; margin-bottom:25px
}

.header h2{
    font-size:1.7rem;
    background:linear-gradient(90deg, var(--cyan), var(--lime));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin:0;
}

.upload-btn{
    background:linear-gradient(135deg, var(--lime), #9acd00);
    padding:12px 26px; border-radius:40px; color:#000!important;
    font-weight:700; text-decoration:none;
    box-shadow:0 10px 25px rgba(204,255,0,.3);
    transition:.3s;
}

.upload-btn:hover{transform:translateY(-3px); box-shadow:0 15px 30px rgba(204,255,0,0.4);}

.card{
    background:var(--glass);
    border:1px solid var(--border);
    border-radius:20px;
    backdrop-filter:blur(15px);
    box-shadow:0 20px 40px rgba(0,0,0,.6);
    padding:25px;
}

.table{width:100%; border-collapse:separate; border-spacing:0 12px}

.table th{
    color:#94a3b8; font-size:.8rem; text-transform:uppercase; padding:10px; text-align:left;
}

.table td{
    background:rgba(255,255,255,.05);
    padding:16px;
}

.table tr:hover td{background:rgba(255,255,255,.1)}

.table td:first-child{border-radius:12px 0 0 12px}
.table td:last-child{border-radius:0 12px 12px 0; text-align:right}

.file{
    display:flex; gap:15px; align-items:center;
}

.icon{
    width:42px; height:42px; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    background:#0f172a; color:var(--cyan);
}

.title{font-weight:600}

.meta{font-size:.75rem; color:#94a3b8}

.badge{
    background:#020617; padding:4px 12px; border-radius:20px; font-size:.8rem;
}

/* Action Button Styles */
.action a{
    margin-left:15px; font-size:1.1rem; transition: 0.2s ease;
}

.edit{color: var(--cyan);}
.edit:hover{color: #fff; text-shadow: 0 0 8px var(--cyan);}

.download{color: var(--lime);}
.download:hover{color: #fff; text-shadow: 0 0 8px var(--lime);}

.delete{color: #ff4d4d;}
.delete:hover{color: #fff; text-shadow: 0 0 8px #ff4d4d;}

.empty{text-align:center; padding:60px; color:#64748b}

.stats{
    margin-top:20px; display:flex; justify-content:space-between; font-size:.85rem;
    border-top: 1px solid var(--border); padding-top: 15px;
}
</style>

<div class="wrap">

    <div class="header">
        <div>
            <h2>üìÅ Course Materials</h2>
            <div style="opacity:.6; margin-top: 5px;">Course: {{ course.title }}</div>
        </div>

        <a href="{% url 'admin_material_upload' course.id %}" class="upload-btn">
            <i class="fa-solid fa-cloud-arrow-up"></i> Upload New
        </a>
    </div>

    <div class="card">
        <table class="table">
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Uploaded By</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for m in materials %}
                <tr>
                    <td>
                        <div class="file">
                            <div class="icon"><i class="fa-solid fa-file"></i></div>
                            <div>
                                <div class="title">{{ m.title }}</div>
                                <div class="meta">ID #{{ m.id }}</div>
                            </div>
                        </div>
                    </td>

                    <td>
                        <span class="badge">
                            <i class="fa-solid fa-user" style="margin-right: 5px;"></i> {{ m.uploaded_by.username }}
                        </span>
                    </td>

                    <td class="action">
                        <a href="{% url 'trainer_material_edit' m.id %}" class="edit" title="Edit details">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </a>

                        <a href="{{ m.file.url }}" target="_blank" class="download" title="Download file">
                            <i class="fa-solid fa-download"></i>
                        </a>

                        <a href="{% url 'admin_material_delete' m.id %}" 
                           onclick="return confirm('Are you sure you want to delete this permanently?')" 
                           class="delete" title="Delete">
                            <i class="fa-solid fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="empty">
                        <i class="fa-regular fa-folder-open fa-3x"></i><br><br>
                        No materials uploaded yet for this course.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="stats">
            <span>Total Resources</span>
            <b style="color:var(--lime)">{{ materials.count }} Files</b>
        </div>
    </div>
</div>

<script>
    // Dynamic Icon Switcher based on file extension
    document.querySelectorAll(".title").forEach(t => {
        let i = t.closest("tr").querySelector(".icon i");
        let n = t.innerText.toLowerCase();
        
        if (n.endsWith(".pdf")) {
            i.className = "fa-solid fa-file-pdf";
            i.style.color = "#ff4d4d"; // Red for PDF
        } else if (n.match(/\.(jpg|png|jpeg|webp)$/)) {
            i.className = "fa-solid fa-file-image";
            i.style.color = "#ccff00"; // Lime for Images
        } else if (n.match(/\.(doc|docx)$/)) {
            i.className = "fa-solid fa-file-word";
            i.style.color = "#448aff"; // Blue for Word
        } else if (n.match(/\.(mp4|mov|avi)$/)) {
            i.className = "fa-solid fa-file-video";
            i.style.color = "#00f3ff"; // Cyan for Video
        } else if (n.match(/\.(zip|rar|7z)$/)) {
            i.className = "fa-solid fa-file-zipper";
        }
    });
</script>

{% endblock %}