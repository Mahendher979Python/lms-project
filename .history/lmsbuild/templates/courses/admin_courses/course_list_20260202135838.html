{% extends "accounts/admin/base.html" %}
{% block content %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

<style>
    /* --- 6D Variables (Neon & Glass Theme) --- */
    :root {
        --neon-cyan: #00f3ff;
        --neon-lime: #ccff00;
        --deep-dark: #0f172a;
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        --text-dim: #94a3b8;
    }

    /* Page Setup */
    .dashboard-container {
        padding: 30px;
        background: radial-gradient(circle at top right, #1e293b, #0f172a);
        min-height: 100vh;
        border-radius: 20px;
    }

    /* --- Header & Summary Cards --- */
    .top-section {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
        margin-bottom: 30px;
    }

    .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        border-radius: 24px;
        border: var(--glass-border);
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        transition: all 0.4s ease;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        border-color: rgba(0, 243, 255, 0.3);
    }

    .page-title {
        font-size: 2.4rem;
        font-weight: 700;
        background: linear-gradient(90deg, var(--neon-cyan), var(--neon-lime));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin: 0;
    }

    /* --- Search & Controls --- */
    .header-controls {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-top: 25px;
    }

    .search-wrapper {
        position: relative;
        flex: 1;
    }

    .search-wrapper input {
        width: 100%;
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 14px 20px 14px 45px;
        border-radius: 16px;
        color: white;
        outline: none;
        transition: 0.3s;
    }

    .search-wrapper input:focus {
        border-color: var(--neon-cyan);
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
    }

    .search-wrapper i {
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--neon-cyan);
    }

    .btn-add {
        background: linear-gradient(135deg, var(--neon-cyan), #0099ff);
        color: #0f172a !important;
        padding: 14px 30px;
        border-radius: 16px;
        text-decoration: none;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: 0.3s;
        box-shadow: 0 10px 20px rgba(0, 243, 255, 0.2);
    }

    .btn-add:hover {
        transform: scale(1.05);
        box-shadow: 0 0 30px var(--neon-cyan);
    }

    /* --- Chart Box --- */
    .chart-box { height: 220px; width: 100%; }

    /* --- Futuristic Table --- */
    .table-container { overflow-x: auto; margin-top: 10px; }
    
    table { width: 100%; border-collapse: separate; border-spacing: 0 12px; }
    
    thead th {
        color: var(--text-dim);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 2px;
        padding: 10px 25px;
        text-align: left;
    }

    tbody tr {
        background: rgba(255, 255, 255, 0.02);
        transition: 0.4s ease;
        border-radius: 16px;
    }

    tbody tr:hover {
        background: rgba(255, 255, 255, 0.07);
        transform: scale(1.01) translateX(5px);
        box-shadow: -5px 0 0 var(--neon-cyan);
    }

    td { padding: 20px 25px; color: #cbd5e1; }
    td:first-child { 
        border-radius: 16px 0 0 16px; 
        font-weight: 600; 
        color: var(--neon-cyan);
    }
    td:last-child { border-radius: 0 16px 16px 0; text-align: right; }

    /* --- Status Badges --- */
    .trainer-pill {
        background: rgba(204, 255, 0, 0.05);
        color: var(--neon-lime);
        padding: 6px 14px;
        border-radius: 10px;
        border: 1px solid rgba(204, 255, 0, 0.2);
        font-size: 0.85rem;
    }

    .level-badge {
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 800;
        text-transform: uppercase;
    }
    .level-beginner { background: rgba(34, 197, 94, 0.15); color: #4ade80; border: 1px solid #22c55e; }
    .level-intermediate { background: rgba(234, 179, 8, 0.15); color: #facc15; border: 1px solid #eab308; }
    .level-advanced { background: rgba(239, 68, 68, 0.15); color: #f87171; border: 1px solid #ef4444; }

    /* --- Actions --- */
    .action-link {
        color: var(--text-dim);
        font-size: 1.2rem;
        margin-left: 15px;
        transition: 0.3s;
        text-decoration: none;
    }
    .action-link:hover { color: var(--neon-cyan); transform: scale(1.2); }
    .del-link:hover { color: #ff4d4d; }

</style>

<div class="dashboard-container">
    
    <div class="top-section">
        <div class="glass-card">
            <span style="color: var(--neon-lime); font-weight: 600; letter-spacing: 2px;">ACADEMIC REPOSITORY</span>
            <h2 class="page-title">Course Library</h2>
            
            <div class="header-controls">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="courseSearch" placeholder="Filter by course name..." onkeyup="searchTable()">
                </div>
                <a href="{% url 'admin_course_create' %}" class="btn-add">
                    <i class="fas fa-plus-square"></i> New Course
                </a>
            </div>
        </div>

        <div class="glass-card">
            <h4 style="margin:0 0 15px 0; text-align:center; color:white; font-size: 0.9rem;">Distribution by Level</h4>
            <div id="courseChart" class="chart-box"></div>
        </div>
    </div>

    <div class="table-container">
        <table id="courseTable">
            <thead>
                <tr>
                    <th>Course Details</th>
                    <th>Mentor</th>
                    <th>Complexity</th>
                    <th>Timeframe</th>
                    <th style="text-align: right;">Operations</th>
                </tr>
            </thead>
            <tbody>
                {% for c in courses %}
                <tr>
                    <td>
                        <span style="display:block;">{{ c.title }}</span>
                        <small style="color: var(--text-dim); font-size: 0.7rem;">ID: #C00{{forloop.counter}}</small>
                    </td>
                    
                    <td>
                        {% if c.trainer %}
                            <span class="trainer-pill"><i class="fas fa-user-circle"></i> {{ c.trainer.user.username }}</span>
                        {% else %}
                            <span style="opacity:0.4; font-size: 0.8rem;">Unassigned</span>
                        {% endif %}
                    </td>

                    <td class="level-cell" data-level="{{ c.level }}">
                        {% if c.level == 'beginner' %}
                            <span class="level-badge level-beginner">Beginner</span>
                        {% elif c.level == 'intermediate' %}
                            <span class="level-badge level-intermediate">Intermediate</span>
                        {% else %}
                            <span class="level-badge level-advanced">Advanced</span>
                        {% endif %}
                    </td>

                    <td><i class="fa-regular fa-clock" style="color: var(--neon-cyan);"></i> {{ c.duration }}</td>

                    <td>
                        <a href="{% url 'admin_material_all_list' c.id %}" class="action-link" title="Course Content">
                            <i class="fa-solid fa-folder-tree"></i>
                        </a>
                        <a href="{% url 'admin_course_edit' c.id %}" class="action-link" title="Edit">
                            <i class="fa-solid fa-sliders"></i>
                        </a>
                        <a href="{% url 'admin_course_delete' c.id %}" class="action-link del-link" 
                           onclick="return confirm('Erase this course permanently?')" title="Delete">
                            <i class="fa-solid fa-trash-can"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" style="text-align:center; padding:50px; color: var(--text-dim);">The library is currently empty.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // 1. ECharts Distribution Logic
    document.addEventListener("DOMContentLoaded", function() {
        const counts = { beginner: 0, intermediate: 0, advanced: 0 };
        document.querySelectorAll('.level-cell').forEach(cell => {
            const lvl = cell.getAttribute('data-level');
            if(lvl in counts) counts[lvl]++;
        });

        const chartDom = document.getElementById('courseChart');
        const myChart = echarts.init(chartDom);
        
        const option = {
            tooltip: { trigger: 'item', backgroundColor: '#1e293b', borderWidth: 0, textStyle: {color: '#fff'} },
            series: [{
                type: 'pie',
                radius: ['60%', '85%'],
                avoidLabelOverlap: false,
                itemStyle: { borderRadius: 10, borderColor: '#0f172a', borderWidth: 2 },
                label: { show: false },
                emphasis: { label: { show: true, fontSize: '12', fontWeight: 'bold', color: '#fff' } },
                data: [
                    { value: counts.beginner, name: 'Beginner', itemStyle: {color: '#22c55e'} },
                    { value: counts.intermediate, name: 'Intermediate', itemStyle: {color: '#eab308'} },
                    { value: counts.advanced, name: 'Advanced', itemStyle: {color: '#ef4444'} }
                ]
            }]
        };
        myChart.setOption(option);
        window.addEventListener('resize', myChart.resize);
    });

    // 2. Real-time Search Logic
    function searchTable() {
        let input = document.getElementById("courseSearch").value.toUpperCase();
        let rows = document.querySelector("#courseTable tbody").rows;
        
        for (let i = 0; i < rows.length; i++) {
            let title = rows[i].cells[0].textContent.toUpperCase();
            rows[i].style.display = title.includes(input) ? "" : "none";
        }
    }
</script>

{% endblock %}